# 心理疲惫度测试开发方案

## 1. 项目概述

### 1.1 核心目标
开发一个纯前端的心理疲惫度测试工具，通过40道题目评估用户的情绪疲惫状态，生成高度个性化的分析报告。

### 1.2 技术栈
- **前端框架**：Vue 3 / React 18
- **状态管理**：Pinia / Redux Toolkit
- **UI组件库**：Ant Design / Element Plus
- **PDF生成**：jsPDF / pdf-lib
- **样式方案**：Tailwind CSS / Styled Components

### 1.3 核心特性
- 40道心理测评题，分4个模块
- 智能计算疲惫等级、类型、场景分析
- 基于「维度+规则+模板片段」的个性化报告生成
- 纯前端实现，无需后端支持
- 支持PDF报告下载

## 2. 系统架构设计

### 2.1 页面结构
```
├── 首页（介绍页）
│   ├── 产品介绍
│   ├── 使用说明
│   └── 开始测试按钮
├── 答题页
│   ├── 题目展示组件
│   ├── 进度条组件
│   └── 导航控制组件
├── 结果页（Web展示）
│   ├── 疲惫等级展示
│   ├── 类型分析展示
│   ├── 场景分析展示
│   ├── 恢复力评估
│   └── 下载报告按钮
└── PDF报告生成
    └── 前端PDF生成模块
```

### 2.2 数据流设计
```
用户答题 → 原始答案数据 → 计算引擎 → 结构化结果 → 报告生成引擎 → 个性化报告
```

## 3. 核心计算引擎设计

### 3.1 答案数据结构
```typescript
interface UserAnswers {
  [questionId: string]: number; // 1-5评分
}

interface RawCalculationData {
  fatigueScores: number[];      // A模块分数
  sceneScores: SceneScores;      // B模块分数
  typeScores: TypeScores;        // C模块分数
  recoveryScores: number[];     // D模块分数
}
```

### 3.2 结果数据结构
```typescript
interface FatigueResult {
  // 基础信息
  fatigueLevel: number;          // 0-4疲惫等级
  fatigueLabel: string;          // 等级标签

  // 场景分析
  sceneScores: {
    work: number;               // 工作/学习分数
    relationship: number;       // 人际/家庭分数
    selfDemand: number;        // 自我要求分数
  };

  // 类型分析
  typeMatches: TypeMatch[];
  primaryType: FatigueType;     // 主类型
  secondaryType: FatigueType;   // 副类型

  // 恢复力
  recoveryLevel: 'low' | 'medium' | 'high';
  recoveryLabel: string;

  // 个性化标签
  personalTags: string[];

  // 报告生成用
  reportProfile: ReportProfile; // 报告生成用的用户画像
}
```

### 3.3 计算逻辑模块

#### 3.3.1 疲惫等级计算
```typescript
function calculateFatigueLevel(answers: UserAnswers): number {
  const fatigureQuestions = ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8'];
  const average = fatigureQuestions.map(q => answers[q]).reduce((a, b) => a + b) / 8;

  if (average < 2.0) return 0;      // 安全区
  if (average < 3.0) return 1;      // 轻度疲惫
  if (average < 3.5) return 2;      // 中度疲惫
  if (average < 4.0) return 3;      // 高度疲惫
  return 4;                         // 极度疲惫
}
```

#### 3.3.2 类型匹配度计算
```typescript
interface FatigueType {
  code: string;
  name: string;
  matchScore: number;      // 0-100匹配度
  avgScore: number;        // 1-5平均分
}

function calculateTypeMatches(answers: UserAnswers): TypeMatch[] {
  const typeMapping = {
    emotional_overload: ['C1', 'C2', 'C3', 'C4'],
    responsibility_trap: ['C5', 'C6', 'C7', 'C8'],
    comparison_anxiety: ['C9', 'C10', 'C11', 'C12'],
    high_pressure_mode: ['C13', 'C14', 'C15', 'C16']
  };

  return Object.entries(typeMapping).map(([code, questions]) => {
    const avgScore = questions.reduce((sum, q) => sum + answers[q], 0) / 4;
    const matchScore = Math.round((avgScore - 1) / 4 * 100);

    return {
      code: `type_${code}`,
      name: getTypeName(code),
      matchScore,
      avgScore
    };
  }).sort((a, b) => b.matchScore - a.matchScore);
}
```

#### 3.3.3 个性化标签生成
```typescript
function generatePersonalTags(result: FatigueResult): string[] {
  const tags: string[] = [];

  // 基于场景分数的标签
  if (result.sceneScores.work >= 3.2)
    tags.push("工作/学习耗竭明显");
  if (result.sceneScores.relationship >= 3.2)
    tags.push("人际/家庭消耗明显");
  if (result.sceneScores.selfDemand >= 3.2)
    tags.push("自我要求偏高、容易苛责");

  // 基于类型的标签
  if (result.primaryType.code === 'type_emotional_overload')
    tags.push("高敏感、高共情");
  if (result.primaryType.code === 'type_responsibility_trap')
    tags.push("习惯扛责、难以说不");
  if (result.primaryType.code === 'type_comparison_anxiety')
    tags.push("容易对比焦虑");
  if (result.primaryType.code === 'type_high_pressure_mode')
    tags.push("习惯高压运转");

  // 基于恢复力的标签
  if (result.recoveryLevel === 'low')
    tags.push("恢复力不足、休息效果有限");

  return tags;
}
```

## 4. 个性化报告生成引擎

### 4.1 报告用户画像（ReportProfile）
```typescript
interface ReportProfile {
  // 基础画像
  fatigueLevel: number;           // 0-4
  primaryType: string;           // 主类型代码
  secondaryType: string;         // 副类型代码
  recoveryLevel: string;         // low/medium/high

  // 场景特征
  dominantScenes: string[];      // 主要掉血场景
  sceneIntensities: {            // 场景强度等级
    work: 'low' | 'medium' | 'high';
    relationship: 'low' | 'medium' | 'high';
    selfDemand: 'low' | 'medium' | 'high';
  };

  // 特殊模式
  specialPatterns: string[];      // 特殊组合模式

  // 关键标签
  keyTags: string[];             // 用于选择金句的标签
}
```

### 4.2 报告生成引擎核心逻辑
```typescript
class PersonalizedReportEngine {
  private templateLibrary: TemplateLibrary;

  generateReport(profile: ReportProfile): ReportContent {
    const report: ReportContent = {
      overview: this.generateOverview(profile),
      primaryTypeAnalysis: this.generatePrimaryTypeAnalysis(profile),
      secondaryTypeSupplement: this.generateSecondaryTypeAnalysis(profile),
      sceneAnalysis: this.generateSceneAnalysis(profile),
      recoveryAssessment: this.generateRecoveryAssessment(profile),
      actionPlan: this.generateActionPlan(profile),
      quotes: this.selectRelevantQuotes(profile)
    };

    return report;
  }

  private generateOverview(profile: ReportProfile): string {
    const template = this.templateLibrary.getOverviewTemplate(profile.fatigueLevel);
    return template.render({
      fatigueLevel: profile.fatigueLevel,
      fatigueLabel: this.getFatigueLabel(profile.fatigueLevel),
      primaryTypeName: this.getTypeName(profile.primaryType)
    });
  }

  private generateSceneAnalysis(profile: ReportProfile): SceneAnalysis {
    const dominantScenes = profile.dominantScenes.slice(0, 2); // 最多分析2个主要场景
    const analyses: string[] = [];

    for (const scene of dominantScenes) {
      const intensity = profile.sceneIntensities[scene];
      const template = this.templateLibrary.getSceneTemplate(scene, intensity);
      analyses.push(template.render({
        sceneName: this.getSceneName(scene),
        intensity: intensity,
        primaryType: profile.primaryType
      }));
    }

    return {
      summary: this.generateSceneSummary(dominantScenes),
      detailedAnalyses: analyses
    };
  }
}
```

### 4.3 模板片段选择规则
```typescript
class TemplateSelector {
  // 选择总评模板
  selectOverviewTemplate(level: number): Template {
    return this.templateLibrary.overerviewTemplates[level];
  }

  // 选择场景分析模板
  selectSceneTemplate(scene: string, intensity: string, primaryType: string): Template {
    // 优先选择特定组合的模板
    const specificKey = `${scene}_${intensity}_${primaryType}`;
    if (this.templateLibrary.hasSpecificTemplate(specificKey)) {
      return this.templateLibrary.getSpecificTemplate(specificKey);
    }

    // 降级到场景+强度的通用模板
    const generalKey = `${scene}_${intensity}`;
    return this.templateLibrary.getGeneralTemplate(generalKey);
  }

  // 选择行动建议模板
  selectActionTemplate(fatigueLevel: number, recoveryLevel: string, dominantScenes: string[]): Template {
    // 根据疲惫等级和恢复力的组合选择策略
    const strategy = this.determineStrategy(fatigueLevel, recoveryLevel);
    return this.templateLibrary.getActionTemplate(strategy, dominantScenes);
  }

  private determineStrategy(fatigueLevel: number, recoveryLevel: string): string {
    if (fatigueLevel <= 1) return 'prevention';
    if (fatigueLevel === 4) return 'intensive';
    if (recoveryLevel === 'low') return 'recovery_focus';
    if (recoveryLevel === 'high') return 'optimization';
    return 'balanced';
  }
}
```

## 5. 前端实现方案

### 5.1 组件设计
```typescript
// 主要Vue组件
components/
├── TestIntroduction.vue        // 介绍页
├── Questionnaire.vue           // 答题页主组件
├── QuestionProgress.vue       // 进度条
├── QuestionItem.vue           // 单个题目组件
├── ResultsOverview.vue        // 结果页总览
├── TypeAnalysis.vue           // 类型分析组件
├── SceneAnalysis.vue          // 场景分析组件
├── RecoveryAssessment.vue     // 恢复力评估组件
├── ActionPlan.vue             // 行动建议组件
└── PDFDownloadButton.vue       // PDF下载按钮
```

### 5.2 状态管理
```typescript
// Pinia store
export const useFatigueTestStore = defineStore('fatigueTest', {
  state: () => ({
    currentStep: 'introduction', // introduction, questionnaire, results
    answers: {} as UserAnswers,
    result: null as FatigueResult | null,
    isCalculating: false
  }),

  actions: {
    saveAnswer(questionId: string, score: number) {
      this.answers[questionId] = score;
    },

    async calculateResults() {
      this.isCalculating = true;
      try {
        this.result = await calculateFatigueResult(this.answers);
      } finally {
        this.isCalculating = false;
      }
    },

    generatePDFReport() {
      if (!this.result) return;
      return generatePDF(this.result);
    }
  }
});
```

### 5.3 PDF生成实现
```typescript
import jsPDF from 'jspdf';

export class PDFReportGenerator {
  private doc: jsPDF;
  private template: PDFTemplate;

  constructor(result: FatigueResult) {
    this.doc = new jsPDF();
    this.template = new PDFTemplate(result);
  }

  async generate(): Promise<Blob> {
    this.addCoverPage();
    this.addOverviewPage();
    this.addDetailedAnalysisPage();
    this.addActionPlanPage();

    return this.doc.output('blob');
  }

  private addCoverPage() {
    // 封面页设计
    this.template.renderCover(this.doc);
  }

  private addOverviewPage() {
    // 概览页设计
    this.template.renderOverview(this.doc);
  }

  private addDetailedAnalysisPage() {
    // 详细分析页（可能多页）
    this.template.renderDetailedAnalysis(this.doc);
  }

  private addActionPlanPage() {
    // 行动建议页
    this.template.renderActionPlan(this.doc);
  }
}
```

## 6. 数据配置管理

### 6.1 题目配置
```typescript
// questions.ts
export const QUESTION_CONFIG = {
  A: {
    title: "整体疲惫强度评估",
    description: "用来判断「你到底有多累」，不区分场景、不谈来源。",
    questions: [
      {
        id: "A1",
        text: "最近一段时间，我早上醒来时，经常觉得自己根本没有真正休息好。",
        category: "fatigue_intensity"
      },
      // ... 其他A类题目
    ]
  },
  B: {
    title: "疲惫场景 / 掉血地图",
    description: "回答「你主要是在哪些场景被榨干」",
    subcategories: {
      work: {
        title: "工作 / 学习压力",
        questions: [
          {
            id: "B1",
            text: "面对工作 / 学习任务时，我经常有一种"怎么追也追不完"的焦虑感。",
            category: "work"
          },
          // ... 其他工作类题目
        ]
      },
      relationship: {
        title: "人际 / 家庭关系消耗",
        questions: [
          // ... 人际关系题目
        ]
      },
      selfDemand: {
        title: "自我要求 / 内心压力",
        questions: [
          // ... 自我要求题目
        ]
      }
    }
  },
  // ... C、D模块配置
};
```

### 6.2 报告模板配置结构
```typescript
// reportTemplates.ts
export const TEMPLATES = {
  overview: {
    0: { /* 0级总评模板 */ },
    1: { /* 1级总评模板 */ },
    2: { /* 2级总评模板 */ },
    3: { /* 3级总评模板 */ },
    4: { /* 4级总评模板 */ }
  },

  typeAnalysis: {
    emotional_overload: {
      primary: { /* 情绪过载主类型模板 */ },
      secondary: { /* 情绪过载副类型模板 */ }
    },
    responsibility_trap: {
      primary: { /* 责任绑架主类型模板 */ },
      secondary: { /* 责任绑架副类型模板 */ }
    },
    // ... 其他类型
  },

  sceneAnalysis: {
    work: {
      high: { /* 工作场景高强度模板 */ },
      medium: { /* 工作场景中等强度模板 */ },
      low: { /* 工作场景低强度模板 */ }
    },
    // ... 其他场景
  },

  recoveryAssessment: {
    low: { /* 恢复力低模板 */ },
    medium: { /* 恢复力中等模板 */ },
    high: { /* 恢复力高模板 */ }
  },

  actionPlan: {
    prevention: { /* 预防策略模板 */ },
    balanced: { /* 平衡调整模板 */ },
    recovery_focus: { /* 恢复重点模板 */ },
    intensive: { /* 密集干预模板 */ }
  },

  quotes: {
    responsibility: [ /* 责任相关金句 */ ],
    sensitivity: [ /* 高敏感相关金句 */ ],
    comparison: [ /* 对比焦虑相关金句 */ ],
    pressure: [ /* 高压模式相关金句 */ ]
  }
};
```

## 7. 开发阶段规划

### 7.1 第一阶段：基础功能
- [x] 需求文档分析
- [ ] 题目配置和基础答题流程
- [ ] 计算引擎实现
- [ ] 基础结果展示

### 7.2 第二阶段：报告生成
- [ ] 模板片段体系设计
- [ ] 报告生成引擎实现
- [ ] 个性化逻辑完善
- [ ] Web结果页优化

### 7.3 第三阶段：PDF生成
- [ ] PDF模板设计
- [ ] PDF生成功能实现
- [ ] 下载功能集成
- [ ] 各浏览器兼容性测试

### 7.4 第四阶段：优化完善
- [ ] 用户体验优化
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] 移动端适配

## 8. 技术风险与应对

### 8.1 主要风险
1. **模板复杂度管理**：模板片段数量可能过多难以维护
2. **个性化程度**：如何在有限模板下实现足够个性化
3. **PDF生成兼容性**：不同浏览器的PDF生成效果差异
4. **计算准确性**：心理测评计算逻辑的准确性

### 8.2 应对策略
1. **模板模块化**：采用高度模块化设计，支持模板复用
2. **版本化模板**：建立模板版本管理系统
3. **渐进增强**：先实现基础版本，逐步增加个性化维度
4. **充分测试**：建立完整的测试用例库

## 9. 后续扩展性

### 9.1 可扩展功能
- 多语言支持
- 主题模式切换
- 测试结果历史记录
- 社交分享功能
- 专业的心理建议集成

### 9.2 数据分析预留
- 匿名统计数据收集
- 用户行为分析
- 测评效果追踪
- 模板效果优化

这个开发方案为实现高度个性化的心理疲惫度测试提供了完整的技术架构和实施路径。